[
  {
    "type": "function",
    "function": {
      "name": "take_screenshot",
      "description": "Capture a screenshot of the screen, a specific window, or a region. Returns a base64-encoded image, JSON metadata for coordinate conversion, and OCR text annotations including clickable coordinates.",
      "parameters": {
        "type": "object",
        "properties": {
          "mode": {
            "type": "string",
            "enum": ["screen", "window", "region"],
            "description": "Capture mode (default: 'window'). Prefer 'window' with app_name for focused screenshots. Only use 'screen' when you need to see multiple windows or the desktop.",
            "default": "window"
          },
          "window_id": {
            "type": "integer",
            "description": "Window ID to capture (required for mode='window')"
          },
          "app_name": {
            "type": "string",
            "description": "Application name to capture (for mode='window', alternative to window_id)"
          },
          "x": {
            "type": "number",
            "description": "X coordinate of region (required for mode='region')"
          },
          "y": {
            "type": "number",
            "description": "Y coordinate of region (required for mode='region')"
          },
          "width": {
            "type": "number",
            "description": "Width of region (required for mode='region')"
          },
          "height": {
            "type": "number",
            "description": "Height of region (required for mode='region')"
          },
          "include_ocr": {
            "type": "boolean",
            "description": "Include OCR text detection with clickable coordinates (default: true)",
            "default": true
          }
        }
      }
    }
  },
  {
    "type": "function",
    "function": {
      "name": "list_windows",
      "description": "List all visible windows on screen with their IDs, titles, app names, and bounds.",
      "parameters": {
        "type": "object",
        "properties": {
          "app_name": {
            "type": "string",
            "description": "Filter windows by application name (optional)"
          }
        }
      }
    }
  },
  {
    "type": "function",
    "function": {
      "name": "list_apps",
      "description": "List all running applications with their names, bundle IDs, and PIDs.",
      "parameters": {
        "type": "object",
        "properties": {
          "app_name": {
            "type": "string",
            "description": "Filter by application name (case-insensitive substring match)"
          },
          "user_apps_only": {
            "type": "boolean",
            "description": "Only return user-facing apps (excludes system agents, helpers, and daemons)"
          }
        }
      }
    }
  },
  {
    "type": "function",
    "function": {
      "name": "focus_window",
      "description": "Bring a window or application to the front. Specify window_id, app_name, or pid.",
      "parameters": {
        "type": "object",
        "properties": {
          "window_id": {
            "type": "integer",
            "description": "Window ID to focus"
          },
          "app_name": {
            "type": "string",
            "description": "Application name to focus"
          },
          "pid": {
            "type": "integer",
            "description": "Process ID to focus"
          }
        }
      }
    }
  },
  {
    "type": "function",
    "function": {
      "name": "launch_app",
      "description": "Launch an application by name. On macOS, finds apps in /Applications and other standard locations. If the app is already running, brings it to the front.",
      "parameters": {
        "type": "object",
        "required": ["app_name"],
        "properties": {
          "app_name": {
            "type": "string",
            "description": "Application name to launch (e.g., 'Calculator', 'Safari')"
          }
        }
      }
    }
  },
  {
    "type": "function",
    "function": {
      "name": "click",
      "description": "Click at screen coordinates. Works with any app (egui, Electron, etc.). Supports screenshot metadata for deterministic conversion. Requires Accessibility permission on macOS.",
      "parameters": {
        "type": "object",
        "properties": {
          "x": {
            "type": "number",
            "description": "Screen X coordinate"
          },
          "y": {
            "type": "number",
            "description": "Screen Y coordinate"
          },
          "window_x": {
            "type": "number",
            "description": "X coordinate relative to window (use with window_id)"
          },
          "window_y": {
            "type": "number",
            "description": "Y coordinate relative to window (use with window_id)"
          },
          "window_id": {
            "type": "integer",
            "description": "Window ID for window-relative coordinates"
          },
          "screenshot_x": {
            "type": "number",
            "description": "X pixel coordinate from screenshot (use with screenshot_origin_* + screenshot_scale or screenshot_window_id)"
          },
          "screenshot_y": {
            "type": "number",
            "description": "Y pixel coordinate from screenshot (use with screenshot_origin_* + screenshot_scale or screenshot_window_id)"
          },
          "screenshot_origin_x": {
            "type": "number",
            "description": "Screenshot origin X (from take_screenshot metadata)"
          },
          "screenshot_origin_y": {
            "type": "number",
            "description": "Screenshot origin Y (from take_screenshot metadata)"
          },
          "screenshot_scale": {
            "type": "number",
            "description": "Screenshot scale factor (from take_screenshot metadata)"
          },
          "screenshot_window_id": {
            "type": "integer",
            "description": "Window ID the screenshot was taken from (legacy: lookup window at click time)"
          },
          "button": {
            "type": "string",
            "enum": ["left", "right", "center"],
            "description": "Mouse button (default: left)"
          },
          "click_count": {
            "type": "integer",
            "description": "Number of clicks (1=single, 2=double)",
            "default": 1
          }
        }
      }
    }
  },
  {
    "type": "function",
    "function": {
      "name": "move_mouse",
      "description": "Move mouse cursor to screen coordinates. Requires Accessibility permission on macOS.",
      "parameters": {
        "type": "object",
        "required": ["x", "y"],
        "properties": {
          "x": {
            "type": "number",
            "description": "Screen X coordinate"
          },
          "y": {
            "type": "number",
            "description": "Screen Y coordinate"
          }
        }
      }
    }
  },
  {
    "type": "function",
    "function": {
      "name": "drag",
      "description": "Drag from one point to another. Requires Accessibility permission on macOS.",
      "parameters": {
        "type": "object",
        "required": ["start_x", "start_y", "end_x", "end_y"],
        "properties": {
          "start_x": {
            "type": "number",
            "description": "Start X coordinate"
          },
          "start_y": {
            "type": "number",
            "description": "Start Y coordinate"
          },
          "end_x": {
            "type": "number",
            "description": "End X coordinate"
          },
          "end_y": {
            "type": "number",
            "description": "End Y coordinate"
          },
          "button": {
            "type": "string",
            "enum": ["left", "right", "center"],
            "description": "Mouse button (default: left)"
          }
        }
      }
    }
  },
  {
    "type": "function",
    "function": {
      "name": "scroll",
      "description": "Scroll at a position. Requires Accessibility permission on macOS.",
      "parameters": {
        "type": "object",
        "required": ["x", "y", "delta_y"],
        "properties": {
          "x": {
            "type": "number",
            "description": "Screen X coordinate to scroll at"
          },
          "y": {
            "type": "number",
            "description": "Screen Y coordinate to scroll at"
          },
          "delta_x": {
            "type": "integer",
            "description": "Horizontal scroll amount (positive=right)",
            "default": 0
          },
          "delta_y": {
            "type": "integer",
            "description": "Vertical scroll amount (negative=up, positive=down)"
          }
        }
      }
    }
  },
  {
    "type": "function",
    "function": {
      "name": "type_text",
      "description": "Type text at the current cursor position. Works with any app. Requires Accessibility permission on macOS.",
      "parameters": {
        "type": "object",
        "required": ["text"],
        "properties": {
          "text": {
            "type": "string",
            "description": "Text to type"
          }
        }
      }
    }
  },
  {
    "type": "function",
    "function": {
      "name": "press_key",
      "description": "Press a key combination. Works with any app. Requires Accessibility permission on macOS.",
      "parameters": {
        "type": "object",
        "required": ["key"],
        "properties": {
          "key": {
            "type": "string",
            "description": "Key to press (e.g., 'return', 'tab', 'escape', 'a', 'f1', 'left', 'up')"
          },
          "modifiers": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Modifier keys: 'shift', 'control', 'option', 'command'",
            "default": []
          }
        }
      }
    }
  },
  {
    "type": "function",
    "function": {
      "name": "get_displays",
      "description": "Get information about all connected displays including bounds, scale factors, and resolution.",
      "parameters": {
        "type": "object",
        "properties": {}
      }
    }
  },
  {
    "type": "function",
    "function": {
      "name": "find_text",
      "description": "PREFERRED for clicking buttons/labels by name. Finds text on screen using the platform accessibility API (macOS Accessibility, Windows UI Automation) with OCR fallback, and returns screen coordinates ready for the click tool. Use this instead of visually estimating coordinates from screenshots. Can be scoped to a specific app window for faster, more precise results. Note: accessibility results use semantic element names (e.g., 'All Clear' instead of 'AC', 'Subtract' instead of '\u2212'), so search by meaning rather than displayed symbol. When no matches are found, the response includes an available_elements array listing all UI element names in the target window \u2014 use this to find the correct name and retry. Requires macOS 10.15+ or Windows 10 1903+.",
      "parameters": {
        "type": "object",
        "required": ["text"],
        "properties": {
          "text": {
            "type": "string",
            "description": "Text to search for (case-insensitive substring match). Matches against accessibility element names first (e.g., 'All Clear', 'Subtract'), then falls back to OCR on visible text."
          },
          "app_name": {
            "type": "string",
            "description": "Application name to scope the search to a specific app's window (e.g., 'Calculator'). Faster and avoids false matches from other windows."
          },
          "window_id": {
            "type": "integer",
            "description": "Window ID to scope the search to a specific window"
          },
          "display_id": {
            "type": "integer",
            "description": "Display ID to search on. Use get_displays to list available displays. If omitted, searches the main display. Ignored when window_id or app_name is provided."
          },
          "uses_language_correction": {
            "type": "boolean",
            "description": "Enable language correction for better word accuracy in OCR fallback. Default is false, which is better for UI automation (buttons, labels, single characters). Has no effect when results come from the accessibility API."
          }
        }
      }
    }
  },
  {
    "type": "function",
    "function": {
      "name": "find_image",
      "description": "Find a template image within a screenshot using template matching. Returns precise click coordinates for non-text UI elements like icons and shapes. Use screenshot_id from take_screenshot or provide screenshot_image_base64. Use template_id from load_image or provide template_image_base64.",
      "parameters": {
        "type": "object",
        "properties": {
          "screenshot_id": {
            "type": "string",
            "description": "Screenshot ID from a previous take_screenshot call (preferred)"
          },
          "screenshot_image_base64": {
            "type": "string",
            "description": "Base64-encoded screenshot image (used if no screenshot_id)"
          },
          "template_id": {
            "type": "string",
            "description": "Image ID from a previous load_image call (preferred over template_image_base64)"
          },
          "template_image_base64": {
            "type": "string",
            "description": "Base64-encoded template image to find (used if no template_id)"
          },
          "mask_id": {
            "type": "string",
            "description": "Image ID from a previous load_image call for the mask"
          },
          "mask_image_base64": {
            "type": "string",
            "description": "Base64-encoded mask image (optional; white=match, black=ignore)"
          },
          "mode": {
            "type": "string",
            "enum": ["fast", "accurate"],
            "description": "Matching mode: 'fast' (default) for quick searches, 'accurate' for thorough matching",
            "default": "fast"
          },
          "threshold": {
            "type": "number",
            "description": "Minimum match score 0.0-1.0 (default: 0.75)"
          },
          "max_results": {
            "type": "integer",
            "description": "Maximum matches to return (default: 3 fast, 5 accurate)"
          },
          "scales": {
            "type": "object",
            "description": "Scale search range {min, max, step}",
            "properties": {
              "min": { "type": "number", "default": 0.8 },
              "max": { "type": "number", "default": 1.2 },
              "step": { "type": "number", "default": 0.1 }
            }
          },
          "search_region": {
            "type": "object",
            "description": "Limit search to region {x, y, w, h} in screenshot pixels",
            "properties": {
              "x": { "type": "integer" },
              "y": { "type": "integer" },
              "w": { "type": "integer" },
              "h": { "type": "integer" }
            }
          },
          "stride": {
            "type": "integer",
            "description": "Search step size (default: 2 fast, 1 accurate)"
          },
          "rotations": {
            "type": "array",
            "items": { "type": "number" },
            "description": "Rotations to try in degrees (only 0, 90, 180, 270 supported)"
          },
          "return_screen_coords": {
            "type": "boolean",
            "description": "Include screen coordinates for clicking (default: true)",
            "default": true
          }
        }
      }
    }
  },
  {
    "type": "function",
    "function": {
      "name": "load_image",
      "description": "Load an image from a local file path and cache it for use with find_image. Returns an image_id that can be passed to find_image as template_id or mask_id. This avoids manually base64-encoding images.",
      "parameters": {
        "type": "object",
        "required": ["path"],
        "properties": {
          "path": {
            "type": "string",
            "description": "Local filesystem path to the image file"
          },
          "id_prefix": {
            "type": "string",
            "description": "Optional prefix for the generated ID (e.g., 'template', 'mask')"
          },
          "max_width": {
            "type": "integer",
            "description": "Maximum width to downscale to (maintains aspect ratio)"
          },
          "max_height": {
            "type": "integer",
            "description": "Maximum height to downscale to (maintains aspect ratio)"
          },
          "as_mask": {
            "type": "boolean",
            "description": "If true, convert to single-channel grayscale mask",
            "default": false
          },
          "return_base64": {
            "type": "boolean",
            "description": "If true, include base64-encoded image data in response",
            "default": false
          }
        }
      }
    }
  }
]
